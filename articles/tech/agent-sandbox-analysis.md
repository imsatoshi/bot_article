---
layout: post
title: "Agent Sandbox æŠ€æœ¯é€‰å‹æ·±åº¦è§£æ"
date: 2026-02-18
categories: tech
tags: [Sandbox, e2b, Unikernel, Firecracker]
permalink: /tech/agent-sandbox/
---

# Agent Sandbox æŠ€æœ¯é€‰å‹æ·±åº¦è§£æ

> åŸæ–‡åœ°å€ï¼šhttps://gaocegege.com/Blog/genai/unikernel-agent  
> ä½œè€…ï¼šgaocegege  
> æ—¶é—´ï¼š2026å¹´2æœˆ

---

## æ ¸å¿ƒé—®é¢˜

> "æ—¢ç„¶ agent è¦çš„æ˜¯è½»é‡ã€å®‰å…¨ã€å¿«é€Ÿå¯åŠ¨ï¼Œä¸ºä»€ä¹ˆæ²¡äººç”¨ unikernelï¼Ÿ"

ä½œè€…å¯¹æ¯”äº†å½“å‰ä¸»æµçš„ Agent Sandbox æ–¹æ¡ˆï¼Œä» infra è§†è§’æ·±å…¥åˆ†æäº†å„è‡ªçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚

---

## Agent Sandbox çš„å››å¤§æ ¸å¿ƒéœ€æ±‚

| éœ€æ±‚ | è¯´æ˜ | å…³é”®æŒ‡æ ‡ |
|------|------|----------|
| **å†·å¯åŠ¨å¿«** | å¿«é€Ÿåˆ›å»ºå’Œé”€æ¯ | ç†æƒ³ < 100ms |
| **å®‰å…¨æ€§é«˜** | éš”ç¦»ä¸å¯ä¿¡ä»£ç  | é˜²æ­¢è¶Šæƒè®¿é—®å’Œæ”»å‡» |
| **æ”¯æŒ Python** | ä¸»æµ Agent å¼€å‘è¯­è¨€ | å…¼å®¹å¸¸è§ Python åº“ |
| **é•œåƒæ„å»ºæ–¹ä¾¿** | å¿«é€Ÿæ„å»ºå’Œéƒ¨ç½² | ç±»ä¼¼ Dockerfile ä½“éªŒ |

---

## æ–¹æ¡ˆä¸€ï¼še2b (Firecracker)

### æ¶æ„
```
Docker é•œåƒ â†’ ext4 rootfs â†’ Firecracker MicroVM â†’ Snapshot
```

### æ„å»ºæµç¨‹
1. **æ‹‰å–åŸºç¡€é•œåƒ**ï¼šä»è¿œç¨‹ä»“åº“è·å– Docker é•œåƒ
2. **æ³¨å…¥é…ç½®å±‚**ï¼šæ·»åŠ ä¸»æœºåã€DNSã€envd æœåŠ¡é…ç½®
3. **æå–æ–‡ä»¶ç³»ç»Ÿ**ï¼šDocker â†’ ext4 rootfs
4. **åˆæ¬¡å¯åŠ¨**ï¼šé¢„ç½®è„šæœ¬ï¼ˆå®‰è£… systemdï¼‰
5. **äºŒæ¬¡å¯åŠ¨**ï¼šsystemd + envd æœåŠ¡å°±ç»ª
6. **åˆ›å»ºå¿«ç…§**ï¼šåºåˆ—åŒ–è¿è¡ŒçŠ¶æ€
7. **ä¸Šä¼ æ¨¡æ¿**ï¼šä¸Šä¼ åˆ°å­˜å‚¨ç³»ç»Ÿ

### è°ƒåº¦ç³»ç»Ÿ
- **ç®—æ³•**ï¼šBest of Kï¼ˆéšæœºé€‰ K ä¸ªèŠ‚ç‚¹ï¼Œé€‰è´Ÿè½½æœ€ä½çš„ï¼‰
- **å®ç°**ï¼šè‡ªç ”è½»é‡çº§ orchestratorï¼ŒNomad åªç®¡ç†æ§åˆ¶å¹³é¢

### æ ¸å¿ƒä¼˜åŠ¿
- âœ… **å¼ºéš”ç¦»**ï¼šç‹¬ç«‹å†…æ ¸ï¼Œæ”»å‡»é¢å°
- âœ… **Snapshot æ¢å¤**ï¼š< 1sï¼ˆIntel <8ms, AMD <3msï¼‰
- âœ… **çŠ¶æ€ä¿æŒ**ï¼šæ”¯æŒ pause/resume

### å…³é”®ä»£ç 
```python
from e2b_code_interpreter import Sandbox

sbx = Sandbox.create()
print('Sandbox created', sbx.sandbox_id)

# æš‚åœæ²™ç®±ï¼ˆä¿å­˜çŠ¶æ€ï¼‰
sbx.beta_pause()

# æ¢å¤æ²™ç®±ï¼ˆä»å¿«ç…§åŠ è½½ï¼‰
same_sbx = sbx.connect()
```

### åŠ£åŠ¿
- âŒ é•œåƒæ„å»ºå¤æ‚ï¼ˆDocker â†’ ext4 è½¬æ¢ï¼‰
- âŒ æ„å»ºæ—¶é—´é•¿
- âŒ éœ€è¦ç»´æŠ¤ç‹¬ç«‹çš„é•œåƒæ„å»ºæµç¨‹

---

## æ–¹æ¡ˆäºŒï¼šk7 (Kata Containers)

### æ¶æ„
```
Docker é•œåƒ + Kata + Firecracker VM
```

### ä¼˜åŠ¿
- âœ… **å®Œå…¨å…¼å®¹ OCI é•œåƒ**ï¼šç›´æ¥ç”¨ Dockerfile æ„å»º
- âœ… **æ„å»ºç®€å•**ï¼šæ— éœ€è½¬æ¢ ext4
- âœ… **Kubernetes é›†æˆ**ï¼šå¯ç”¨ k3s è°ƒåº¦

### åŠ£åŠ¿
- âŒ **æ— æ³•åˆ©ç”¨ Firecracker snapshot**ï¼ˆVM é‡Œè·‘ containerï¼Œæ¢å¤å¤æ‚ï¼‰
- âŒ å¯åŠ¨æ—¶é—´ç›¸å¯¹è¾ƒé•¿

### æ ¸å¿ƒè§‚ç‚¹
> "resume èƒ½åŠ›æ˜¯ä¸æ˜¯ agent sandbox éœ€è¦çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¯èƒ½è¿˜è¦æ‰“ä¸ªé—®å·ã€‚å¯¹äºç®€å•åœºæ™¯ï¼ŒOCI å…¼å®¹æ€§å¯èƒ½æ›´æœ‰å¸å¼•åŠ›ã€‚"

---

## æ–¹æ¡ˆä¸‰ï¼šMonty (WASM)

### å¯åŠ¨æ—¶é—´å¯¹æ¯”
| æ–¹æ¡ˆ | å¯åŠ¨æ—¶é—´ |
|------|----------|
| **Monty** | **0.06ms** ğŸš€ |
| å®¹å™¨ | ~50ms |
| Firecracker | ~125ms |

### é—®é¢˜
- âŒ **Python æ”¯æŒå—é™**ï¼šWASI æ¥å£å¤ªå°‘
- âŒ **åŠŸèƒ½é˜‰å‰²**ï¼šä¸æ”¯æŒ classã€sys æ¨¡å—ç­‰
- âŒ **ç”Ÿæ€ä¸æˆç†Ÿ**ï¼šPyodide å†·å¯åŠ¨ææ…¢ï¼ˆéœ€ç¼–è¯‘æ•´ä¸ª CPythonï¼‰

### ä½œè€…è¯„ä»·
> "Monty æ”¯æŒçš„è¯­æ³•å­é›†å¤ªå°ï¼Œè¿™æ ·çš„é˜‰å‰²ä¸‹ï¼Œunikernel åè€Œæ„Ÿè§‰æ›´æœ‰ä¼˜åŠ¿ã€‚"

---

## æ–¹æ¡ˆå››ï¼šUnikernelï¼ˆç†è®ºæœ€ä¼˜ï¼‰

### ç†è®ºä¼˜åŠ¿
- âœ… **æ”»å‡»é¢æå°**ï¼šæ— å¤šä½™ shellï¼Œæ— æ— ç”¨ç³»ç»Ÿè°ƒç”¨
- âœ… **å¯åŠ¨æ¯«ç§’çº§**ï¼šåº”ç”¨ä¸å†…æ ¸ç¼–è¯‘æˆå•ä¸€é•œåƒ
- âœ… **é•œåƒä½“ç§¯æå°**ï¼šåªåŒ…å«å¿…è¦ç»„ä»¶

### å†å²é—®é¢˜
- âŒ **ä¸æ”¯æŒå¤šè¿›ç¨‹**ï¼šä¼ ç»Ÿ unikernel å•åœ°å€ç©ºé—´
- âŒ **Python å…¼å®¹æ€§å·®**ï¼šPython é‡åº¦ä¾èµ–å¤šè¿›ç¨‹

### æ–°è¿›å±•ï¼ˆ2024ï¼‰

#### Unikraft 0.19
- å¼€å§‹æ”¯æŒå¤šè¿›ç¨‹ï¼ˆvfork å®ç°ï¼‰
- å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«åœ°å€ç©ºé—´
- **å±€é™æ€§**ï¼šå­è¿›ç¨‹å¿…é¡»ç«‹åˆ» execveï¼Œå¦åˆ™å†…å­˜äº’ç›¸å¹²æ‰°

#### UKL (Unikernel Linux)
- åº”ç”¨ç›´æ¥é“¾æ¥åˆ° Linux å†…æ ¸
- åœ¨ supervisor æƒé™ä¸‹è¿è¡Œ
- **æƒè¡¡**ï¼šä¿ç•™å¤šè¿›ç¨‹èƒ½åŠ›ï¼Œä½†å¤±å»æå°æ”»å‡»é¢ä¼˜åŠ¿

### æœªæ¥åˆ¤æ–­
> "unikernel åœ¨æ”¯æŒå¤šè¿›ç¨‹åï¼Œå¯èƒ½æ˜¯ agent sandbox çš„ç†æƒ³åº•åº§ã€‚"

---

## å…³é”®æŠ€æœ¯æ´å¯Ÿ

### 1. Kubernetes ä¸é€‚åˆ Agent Sandbox

**åŸå› **ï¼š
- K8s é€‚åˆ**é•¿æœŸè¿è¡Œ**çš„æœåŠ¡
- Agent sandbox **ç”Ÿå‘½å‘¨æœŸæçŸ­**ï¼ˆç§’çº§ï¼‰
- K8s **å¤ªé‡**ï¼Œä¸é€‚åˆæœ¬åœ°è¿è¡Œæˆ–å°é›†ç¾¤
- Agent éœ€è¦åœ¨æœ¬åœ°å’Œ cloud ä¹‹é—´æ— ç¼è¿ç§»

**e2b çš„è§£æ³•**ï¼šè‡ªç ”è½»é‡çº§è°ƒåº¦å™¨ï¼ŒNomad åªç”¨äºæ§åˆ¶å¹³é¢éƒ¨ç½²

### 2. é•œåƒåˆ†å‘æ˜¯æœ€å¤§ç“¶é¢ˆ

**ä¼ ç»Ÿ Docker æ‹‰å–çš„é—®é¢˜**ï¼š
```
ä¸²è¡Œä¸‹è½½ gzip å±‚ (2 GiB/s)
    â†“
å•çº¿ç¨‹è§£å‹ (80 MiB/s)  
    â†“
è§£åŒ…åˆ°æ–‡ä»¶ç³»ç»Ÿ
    â†“
8GB é•œåƒ = 1åˆ†é’Ÿï¼
```

**Modal çš„ Lazy Loading æ–¹æ¡ˆ**ï¼š
- é€šè¿‡ **FUSE** æ‹¦æˆªæ–‡ä»¶ç³»ç»Ÿè¯»å–
- ç”Ÿæˆå ä½æ–‡ä»¶ç³»ç»Ÿæ ‘ï¼ˆåªæœ‰å…ƒæ•°æ®ï¼‰
- **æŒ‰éœ€åŠ è½½ä¼˜å…ˆçº§**ï¼š
  ```
  å†…å­˜ â†’ æœ¬åœ° SSD â†’ ç¼“å­˜æœåŠ¡å™¨ â†’ CDN â†’ å¯¹è±¡å­˜å‚¨
  ```
- æå¤§å‡å°‘å¯åŠ¨æ—¶é—´

### 3. å„æ–¹æ¡ˆ Trade-off æ€»ç»“

| æ–¹æ¡ˆ | å¯åŠ¨æ—¶é—´ | éš”ç¦»æ€§ | Python æ”¯æŒ | é•œåƒæ„å»º | é€‚ç”¨åœºæ™¯ |
|------|---------|--------|------------|----------|----------|
| e2b (Firecracker) | å¿« + snapshot | â­â­â­â­â­ | å®Œæ•´ | å¤æ‚ | é«˜é¢‘å¯åœã€éœ€çŠ¶æ€ä¿æŒ |
| k7 (Kata) | ä¸­ç­‰ | â­â­â­â­ | å®Œæ•´ | ç®€å• | K8s é›†æˆã€ç®€å•åœºæ™¯ |
| Monty (WASM) | ğŸš€ æå¿« | â­â­â­ | å—é™ | ç®€å• | æç®€ Python è„šæœ¬ |
| Unikernel | ç†è®ºæœ€å¿« | â­â­â­â­â­ | å¾…å®Œå–„ | ä¸­ç­‰ | **æœªæ¥ç†æƒ³æ–¹æ¡ˆ** |

---

## æ ¸å¿ƒç»“è®º

1. **Firecracker** æ˜¯å½“å‰ä¸»æµé€‰æ‹©ï¼Œå¹³è¡¡äº†éš”ç¦»æ€§å’Œå¯åŠ¨é€Ÿåº¦ï¼Œä½†é•œåƒæ„å»ºå¤æ‚

2. **Kata** é€‚åˆéœ€è¦å¿«é€Ÿæ„å»ºå’Œ K8s é›†æˆçš„åœºæ™¯ï¼Œä½†ç‰ºç‰²äº† snapshot èƒ½åŠ›

3. **WASM** å¯åŠ¨æœ€å¿«ï¼Œä½† Python æ”¯æŒæ˜¯ç¡¬ä¼¤ï¼ŒåŠŸèƒ½é˜‰å‰²ä¸¥é‡

4. **Unikernel** ç†è®ºä¸Šæœ€é€‚åˆ Agent Sandboxï¼š
   - æå°æ”»å‡»é¢ + æ¯«ç§’çº§å¯åŠ¨ + æå°é•œåƒ
   - éšç€å¤šè¿›ç¨‹æ”¯æŒçš„å®Œå–„ï¼Œå¯èƒ½æˆä¸ºæœªæ¥æœ€ä¼˜è§£

5. **é•œåƒåˆ†å‘æ•ˆç‡** ä¸ **å¯åŠ¨æ—¶é—´** åŒæ ·é‡è¦ï¼š
   - Modal çš„ lazy loading å€¼å¾—å€Ÿé‰´
   - å¯¹äº LLM æ¨ç†æœåŠ¡å°¤å…¶é‡è¦ï¼ˆé•œåƒå’Œæ¨¡å‹éƒ½å¾ˆå¤§ï¼‰

---

## å»¶ä¼¸æ€è€ƒ

### ä¸ºä»€ä¹ˆ unikernel ä¹‹å‰æ²¡è¢«å¹¿æ³›é‡‡ç”¨ï¼Ÿ

- **ç”Ÿæ€æƒ¯æ€§**ï¼šDocker ç”Ÿæ€å¤ªå¼ºå¤§ï¼Œå¼€å‘è€…ä¹ æƒ¯éš¾ä»¥æ”¹å˜
- **æ„å»ºæˆæœ¬**ï¼šéœ€è¦é‡æ–°ç¼–è¯‘åº”ç”¨ï¼Œè¿ç§»æˆæœ¬é«˜
- **è°ƒè¯•å›°éš¾**ï¼šæ²¡æœ‰ shellï¼Œè°ƒè¯•ä½“éªŒå·®

### ä¸ºä»€ä¹ˆç°åœ¨å¯èƒ½æœ‰æœºä¼šï¼Ÿ

- **Agent åœºæ™¯å…´èµ·**ï¼šçŸ­ç”Ÿå‘½å‘¨æœŸã€é«˜å®‰å…¨éœ€æ±‚ã€å¿«é€Ÿå¯åŠ¨
- **Python å¤šè¿›ç¨‹æ”¯æŒ**ï¼šUnikraft 0.19 å¼€å§‹æ”¯æŒ
- **äº‘åŸç”Ÿæ¼”è¿›**ï¼šä» VM â†’ å®¹å™¨ â†’ æ›´è½»é‡çš„éš”ç¦»æŠ€æœ¯

---

## å…³é”®å¼•ç”¨

> "Kubernetes å¹¶ä¸é€‚åˆ agent sandbox çš„è°ƒåº¦ã€‚Kubernetes é€‚åˆé•¿æœŸè¿è¡Œçš„æœåŠ¡ï¼Œæˆ–è€…è¯´ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿çš„å·¥ä½œè´Ÿè½½ã€‚agent sandbox çš„ç”Ÿå‘½å‘¨æœŸéå¸¸çŸ­ã€‚"

> "é•œåƒå¸¦æ¥çš„å¯åŠ¨æ—¶é—´å¼€é”€æ˜¯è¿œå¤§äºå¯åŠ¨æœ¬èº«çš„ï¼Œè¿™æ‰æ˜¯å»¶è¿Ÿæœ€å¤§çš„å•ä¸€æ¥æºã€‚"

> "unikernel åœ¨æ”¯æŒå¤šè¿›ç¨‹åï¼Œå¯èƒ½æ˜¯ agent sandbox çš„ç†æƒ³åº•åº§ã€‚"

---

## å‚è€ƒé“¾æ¥

- [e2b GitHub](https://github.com/e2b-dev/e2b)
- [k7 GitHub](https://github.com/Katakate/k7)
- [Monty GitHub](https://github.com/pydantic/monty)
- [Modal Lazy Loading è§†é¢‘](https://www.youtube.com/watch?v=...)
- [Unikraft å®˜ç½‘](https://unikraft.org/)

---

**License**: CC BY-NC-SA 3.0
