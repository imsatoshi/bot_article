---
layout: post
title: "Multi-Agent架构实战：投资委员会5种模式解析"
description: "用Agno框架构建7个专业智能体的投资委员会，对比Route/Broadcast/Coordinate/Task/Workflow五种架构模式"
date: 2026-02-19
categories: ai
tags: [multi-agent, agno, investment, architecture, ai]
permalink: /ai/multi-agent-architectures/
---

# 投资委员会实战：5种多智能体架构深度解析

> 原文作者: Ashpreet Bedi (Agno创始人)  
> 原文链接: https://x.com/i/status/2024293702001135648  
> 整理时间: 2026-02-19

---

## 为什么大多数多智能体教程都是玩具？

大多数教程只展示一种编排模式应用于简单问题：四个智能体聊天气，互相认同，最后产出一个单智能体就能写的答案。智能体没有专业化分工，没有分歧，更不会学习。

这篇文章不一样。我们将构建一个**包含7个专业智能体的投资委员会**，横跨**5种不同架构**，展示架构选择如何改变结果质量。

---

## 投资委员会：最古老的多智能体系统

投资委员会是世界上最古老的多智能体系统之一：一群专家，各自拥有不同专长、不同工具、不同盲点，共同评估机会并做出资本配置决策。

它自然映射了多智能体系统应该展示的核心要素：

- **专业化至关重要** — 一个分析师同时覆盖宏观、基本面、技术面和风险，每个维度都会很浅。分离的智能体配合专用工具才能深入
- **编排至关重要** — 主席应该逐个询问分析师？还是同时发言？固定流程还是动态调整？答案取决于问题本身
- **记忆至关重要** — 每次都从零开始的委员会毫无价值。记住上季度决策、犯的错误、发现的模式：这才是一个机构

---

## 系统架构概览

这是一个管理 **$1000万美元资金** 投资美国公共股票的系统。每次分析都基于实时市场数据，每个推荐都必须遵守真实的投资授权，包括仓位限制、行业上限和风险约束。

### 7个专业智能体

| 角色 | 模型 | 职责 | 工具 |
|------|------|------|------|
| **市场分析师** | Sonnet 4.6 | 宏观趋势、行业分析、突发新闻 | Exa MCP + YFinance |
| **财务分析师** | Sonnet 4.6 | 基本面、估值、资产负债表 | YFinance |
| **技术分析师** | Sonnet 4.6 | 价格行为、动量、支撑/阻力位 | YFinance |
| **风险官** | Sonnet 4.6 | 下行情景、仓位规模、合规检查 | YFinance |
| **知识智能体** | Sonnet 4.6 | 备忘录存档 + 研究库 | FileTools / Vector Search |
| **备忘录撰写者** | Sonnet 4.6 | 将分析综合为正式投资备忘录 | FileTools |
| **委员会主席** | Opus 4.6 | 最终决策、资本配置 | - |

> 专业分析师使用 Sonnet：快速、能力强、性价比高的专注分析。主席使用 Opus：更强的推理能力来综合冲突观点并做出最终决策。

---

## 五种多智能体架构对比

核心洞察：**同样的7个智能体，不同的编排方式产生不同结果**。

---

### 1. Route 模式 — 单专家路由

最简单的架构。每个问题都发送给**恰好一个**专家。

- "AAPL的市盈率是多少？" → 财务分析师
- "我们关于TSLA的决定是什么？" → 知识智能体
- "写一篇NVIDIA的备忘录" → 备忘录撰写者

**适用场景**: 快速、有针对性的问题。当你明确知道自己需要什么时。

---

### 2. Broadcast 模式 — 广播独立分析

同样的问题同时发送给**所有四个分析师**。各自独立响应，看不到彼此的工作。

没有锚定偏见，没有群体思维。财务分析师不会被市场分析师的乐观影响。风险官不会因为其他人看涨而软化担忧。

然后主席综合独立观点，记录一致和分歧之处，做出最终决策。

**适用场景**: 高风险的配置决策。当你想要"秘密投票"机制后再由主席决策时。

---

### 3. Coordinate 模式 — 动态协调

Route 发送给一个专家。Broadcast 发送给所有人。Coordinate 是中间地带：**主席根据对话进展动态决定咨询哪些分析师，以什么顺序**。

问"我们应该增加NVIDIA敞口吗？"，主席可能：
1. 先从财务分析师开始
2. 看到强劲基本面后咨询市场分析师
3. 在做仓位决策前咨询风险官
4. 最后让备忘录撰写者记录一切

主席会适应。如果财务分析师提出危险信号，主席可能完全跳过技术分析师，直接去找风险官。这就是真正的委员会主席主持会议的方式：读懂房间，跟随线索，而不是机械地走流程。

**适用场景**: 开放式投资问题。"我们应该投资吗？""你怎么看这只股票？"

---

### 4. Task 模式 — 任务分解

问"在排名前5的AI股票中部署100万美元，单个仓位不超过30%"，主席自主将其分解为带依赖关系的子任务：

```
任务1: 市场分析师 → 识别前5大AI股票
任务2: 财务分析师 → 深度基本面分析 (依赖1)
任务3: 技术分析师 → 入场时机分析 (依赖1)
任务4: 风险官 → 组合风险评估 (依赖2,3)
任务5: 备忘录撰写者 → 配置备忘录 (依赖4)
```

任务1完成后，任务2和3并行运行。任务4等待两者完成。任务5产出最终结果。

**适用场景**: 复杂的多步骤问题，人类PM会分解成项目计划的场景。

---

### 5. Workflow 模式 — 固定工作流

固定、可重复的流水线：

```
市场评估 → ┌─ 基本面分析 ─┐ → 风险评估 → 备忘录 → 主席决策
           └─ 技术面分析 ─┘
```

每个股票都经过完全相同的流程。没有动态路由，没有自主分解。每一步的输出进入下一步。

**适用场景**: 标准化、可审计的审查。当一致性和可追溯性比灵活性更重要时。

---

## 三层知识架构：知识应该住在哪里？

几乎所有多智能体演示都会犯的错误：把所有知识倒入单个向量数据库，希望语义搜索能在正确时间找到正确的东西。

这在投资委员会中行不通。考虑三种知识类型：

### Layer 1: 静态上下文 (系统提示)

投资授权说"单一仓位最大：基金的30%"。如果风险官因为向量搜索返回了不同块而错过这条，委员会会批准500万美元仓位并违反自己的规则。

**风险限制不应该是可搜索的，它们应该是不可避免的。**

**实现**: Python f-string 直接注入
```python
COMMITTEE_CONTEXT = load_context()  # 读取 mandate.md, risk_policy.md, process.md

instructions = f"""
## Committee Rules (ALWAYS FOLLOW)
{COMMITTEE_CONTEXT}
## Your Role...
"""
```

### Layer 2: 研究库 (RAG)

包含50+公司的档案。当财务分析师询问NVIDIA的竞争护城河时，语义搜索正好适用。你不想把所有公司档案都塞进系统提示。

**实现**: PgVector + 混合搜索

### Layer 3: 备忘录存档 (文件系统)

过去投资备忘录是2000字的结构化文档：论点、分析、风险评估、委员会决策。切成512 token的向量片段会失去结构，失去论点与决策之间的联系。

**实现**: FileTools，知识智能体发现备忘录，整篇阅读

> 就像 Claude Code 搜索代码库，知识智能体搜索备忘录。

**核心原则**: 知识住在哪里决定了智能体使用它的可靠性。关键规则进提示，大型语料库进RAG，结构化文档作为文件浏览。

---

## 智能体学习：从知识到智慧

知识告诉智能体它们知道什么。**学习告诉它们它们发现了什么。**

每个分析师智能体（市场、财务、技术、风险）都配置了 `LearningMachine` 和 `LearningMode.AGENTIC`：

- **分析前**: 搜索相关过去学习
- **分析后**: 保存新模式、修正、洞察
- **共享知识库**: namespace="global"，所有智能体受益

### 学习示例

| 场景 | 学习内容 | 影响 |
|------|----------|------|
| 委员会因高beta减少NVDA仓位 | "NVDA配置受高beta限制($1.5M)和科技行业上限(40%)双重约束" | 下次提到NVDA，风险官立即引用 |
| 用户纠正收入分解错误 | "NVDA的AI收入主要来自数据中心，不是消费级GPU" | 财务分析师以后强调正确板块 |
| 发现两只股票联动 | "NVDA和AMD高度相关，同时持有产生集中风险" | 风险官在组合构建时标记 |
| YFinance数据误导 | "YFinance高成长股的trailing P/E可能误导，必须检查forward P/E" | 财务分析师调整方法论 |

**这就是将一群智能体转变为机构的东西**：一个随时间积累智慧的组织。

---

## 快速开始

```bash
# 克隆仓库
git clone https://github.com/agno-agi/investment-committee.git
cd investment-committee

# 配置环境变量
cp example.env .env
# 编辑 .env 添加 API keys

# 启动服务
docker compose up -d --build

# 加载研究知识库
docker exec -it aic-api python -m app.load_knowledge
```

### 测试用例

| 提示 | 模式 | 预期行为 |
|------|------|----------|
| "AAPL的市盈率是多少？" | Route | 发送给财务分析师 |
| "全面审查：评估TSLA $200万投资" | Broadcast | 四个独立分析，然后综合 |
| "我们应该投资NVIDIA吗？" | Coordinate | 主席协调多分析师讨论 |
| "在前5大AI股票中部署$1000万" | Task Mode | 自主分解为并行工作流 |
| "对NVIDIA运行完整投资审查" | Workflow | 五步确定性流水线 |
| "我们有哪些过去备忘录？" | Route | 发送给知识智能体进行文件导航 |

---

## 关键启示

**架构选择塑造智能**。明智地选择：

- **Route** → 效率：调用正确的部门
- **Broadcast** → 共识：独立投票，然后综合
- **Coordinate** → 探索：主席主持会议
- **Task Mode** → 复杂问题：PM分配带依赖的工作
- **Workflow** → 可重复流程：流水线

这些模式远适用于金融领域之外的任何需要专业智能体、结构化知识和机构记忆的领域。

---

**⚠️ 免责声明**: 这是技术演示，不是投资建议。不要基于AI智能体的推荐做投资决策。

**技术栈**: Agno框架 + Claude模型 + YFinance + Exa MCP + PgVector + Docker
